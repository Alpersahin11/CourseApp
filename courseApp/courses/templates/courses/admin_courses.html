{% extends "_layout.html" %}
{% load static %}

{% block title %}My Courses{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>My Courses</h2>
    <a href="{% url 'create_course' %}" class="btn btn-success">Add New Course</a>
  </div>

  {% if page_obj.object_list %}
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle text-center">
      <thead class="table-dark">
  <tr>
    <th scope="col" style="width: 150px;">Image</th>
    <th scope="col">Title</th>
    <th scope="col" style="max-width: 300px;">Description</th>
    <th scope="col" style="width: 150px;">Students</th>
    <th scope="col" style="width: 200px;">Categories</th>
    <th scope="col" style="width: 150px;">Created At</th>
    <th scope="col" style="width: 200px;">Videos</th>
    <th scope="col" style="width: 120px;">Edit</th>
    <th scope="col" style="width: 120px;">Delete</th>
  </tr>
</thead>
<tbody>
  {% for course in page_obj.object_list %}
  <tr>
    <td>
      {% if course.img %}
        <img src="{{ course.img.url }}" alt="{{ course.title }}" class="img-thumbnail" style="max-width: 140px; height: auto;">
      {% else %}
        <img src="{% static 'img/default-course.png' %}" alt="No Image" class="img-thumbnail" style="max-width: 140px; height: auto;">
      {% endif %}
    </td>
    <td class="fw-bold align-middle">{{ course.title }}</td>
    <td class="text-truncate" style="max-width: 300px;">{{ course.description|safe|truncatewords:10 }}</td>
    <td class="align-middle">{{ course.enrolled_students.all.count }}</td>
    <td class="align-middle">
      {% for cat in course.category.all %}
        <span class="badge bg-secondary">{{ cat.name }}</span>
      {% empty %}
        <span class="text-muted">No categories</span>
      {% endfor %}
    </td>
    <td class="align-middle">{{ course.date|date:"d M Y" }}</td>

    <td class="align-middle">
      <a href="{% url 'course_detail' course.id %}" class="btn btn-outline-success btn-sm w-100">
        <i class="bi bi-pencil"></i> Add Videos
      </a>
    </td>


    <td class="align-middle">
      <a href="{% url 'edit_course' course.id %}" class="btn btn-outline-primary btn-sm w-100">
        <i class="bi bi-pencil"></i> Edit
      </a>
    </td>

    <td class="align-middle">
      <form method="POST" action="{% url 'delete_course' course.id %}" onsubmit="return confirm('Are you sure you want to delete this course?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-danger btn-sm w-100">
          <i class="bi bi-trash"></i> Delete
        </button>
      </form>
    </td>

  </tr>
  {% endfor %}
</tbody>

    </table>
  </div>

  <!-- Pagination -->
  <nav aria-label="Course pagination" class="mt-4">
    <ul class="pagination justify-content-center">
      {% if page_obj.paginator.num_pages > 1%}

      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
      {% endif %}

      {% for i in page_obj.paginator.page_range %}
      <li class="page-item {% if page_obj.number == i %}active{% endif %}">
        <a class="page-link" href="?page={{ i }}">{{ i }}</a>
      </li>
      {% endfor %}

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">Next</span>
      </li>
      {% endif %}

      {% endif %}

    </ul>
  </nav>

  {% else %}
  <div class="alert alert-info text-center">
    You have not created any courses yet. <a href="{% url 'create_course' %}">Create your first course now!</a>
  </div>
  {% endif %}
</div>
{% endblock %}
