{% extends "_layout.html" %}
{% load static %}

{% load widget_tweaks %}

{% block title %} Manage Categories {% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-primary">Manage Categories</h2>

  <div class="card mb-5 shadow-sm">
    <div class="card-header bg-success text-white">
      <h4 class="mb-0">Add New Category</h4>
    </div>
    <div class="card-body">
      <form method="post" action="{% url 'manage_categories' %}" class="row g-3 align-items-center">
        {% csrf_token %}
        <div class="col-sm-8">
          {{ form.name|add_class:"form-control" }}
        </div>
        <div class="col-sm-4">
          <button type="submit" class="btn btn-success w-100">Add Category</button>
        </div>
      </form>
    </div>
  </div>

  <h4 class="mb-3">Existing Categories</h4>
  <table class="table table-hover table-bordered align-middle shadow-sm">
    <thead class="table-light">
      <tr>
        <th scope="col" style="width: 5%;">#</th>
        <th scope="col">Name</th>
        <th scope="col" style="width: 15%;">Number of Courses</th>
        <th scope="col" style="width: 20%;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for category in categories %}
      <tr>
        <th scope="row">{{ forloop.counter }}</th>

        {% if edit_id == category.id %}
          <form method="post" action="{% url 'edit_category' category.id %}" class="d-flex align-items-center">
            {% csrf_token %}
            <td colspan="2">
              {{ edit_form.name|add_class:"form-control" }}
            </td>
            <td>
              <button type="submit" class="btn btn-primary btn-sm me-2">Save</button>
              <a href="{% url 'manage_categories' %}" class="btn btn-secondary btn-sm">Cancel</a>
            </td>
          </form>
        {% else %}
          <td>{{ category.name }}</td>
          <td>{{ category.course_count }}</td>
          <td>
            <a href="{% url 'edit_category' category.id %}" class="btn btn-warning btn-sm me-2">Edit</a>
            <a href="{% url 'delete_category' category.id %}" class="btn btn-danger btn-sm"
               onclick="return confirm('Are you sure you want to delete this category?');">Delete</a>
          </td>
        {% endif %}
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center fst-italic text-muted">No categories found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
