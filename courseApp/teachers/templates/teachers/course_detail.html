{% extends "_layout.html" %}
{% load static %}
{% block title %}{{ course.title }}{% endblock %}

{% block content %}
<div class="container py-4">
  

  <div class="row">
    <!-- üé• Video Player -->
    <div class="col-md-8">
      <div class="card mb-3">
        <div class="card-body">
          <video id="mainVideo" width="100%" height="480" controls>
            {% with first_video=course.sections.first.videos.first %}
              {% if first_video %}
                <source src="{{ first_video.video_file.url }}" type="video/mp4">
              {% else %}
                <p>No video available</p>
              {% endif %}
            {% endwith %}
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    </div>

    <!-- üìö Section + Video List -->
    <div class="col-md-4">
      <div class="accordion" id="videoAccordion">
        {% for section in course.sections.all %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false"
                aria-controls="collapse{{ forloop.counter }}">
                {{ section.title }}
              </button>
            </h2>
            <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
              aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#videoAccordion">
              <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                  {% for video in section.videos.all %}
                    <li class="list-group-item">
                      <button class="btn btn-link p-0 text-start w-100 video-btn"
                        data-video-url="{{ video.video_file.url }}">
                        {{ video.order }}. {{ video.title }}
                      </button>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1>{{ course.title }}</h1>
      <p>{{ course.description|safe }}</p>
    </div>
    <a href="{% url 'edit_course_structure' course.id %}" class="btn btn-warning">
      ‚úèÔ∏è Edit Course
    </a>
  </div>
  </div>
</div>

<!-- üîß Script to change video dynamically -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const videoButtons = document.querySelectorAll(".video-btn");
    const videoPlayer = document.getElementById("mainVideo");

    videoButtons.forEach(button => {
      button.addEventListener("click", function () {
        const url = this.getAttribute("data-video-url");
        videoPlayer.querySelector("source").setAttribute("src", url);
        videoPlayer.load();
        videoPlayer.play();
      });
    });
  });
</script>
{% endblock %}
