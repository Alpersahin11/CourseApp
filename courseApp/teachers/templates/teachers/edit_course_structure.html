{% extends "_layout.html" %}
{% load static %}

{% block title %}Edit Course Structure{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="mb-4">Manage Structure: {{ course.title }}</h2>

  <!-- Section Ekleme -->
  <form method="post" action="{% url 'add_section' course.id %}" class="mb-4 d-flex gap-2">
    {% csrf_token %}
    <input type="text" name="title" class="form-control" placeholder="New Section Title" required>
    <button type="submit" class="btn btn-primary">+ Add Section</button>
  </form>

  {% for section in course.sections.all %}
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>{{ section.order }}. {{ section.title }}</strong>
        <div class="d-flex gap-2">
          <a href="{% url 'move_section_up' section.id %}" class="btn btn-sm btn-outline-secondary">‚¨ÜÔ∏è</a>
          <a href="{% url 'move_section_down' section.id %}" class="btn btn-sm btn-outline-secondary">‚¨áÔ∏è</a>
          <form method="post" action="{% url 'delete_section' section.id %}" onsubmit="return confirm('Are you sure?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger">üóëÔ∏è</button>
          </form>
        </div>
      </div>

      <div class="card-body">
        <!-- Video Ekleme -->
        <form method="post" action="{% url 'add_video' section.id %}" enctype="multipart/form-data" class="mb-3 d-flex gap-2">
          {% csrf_token %}
          <input type="text" name="title" class="form-control" placeholder="Video Title" required>
          <input type="file" name="video_file" class="form-control" required>
          <button type="submit" class="btn btn-success">+ Add Video</button>
        </form>

        <!-- Videolar Listesi -->
        <ul class="list-group">
          {% for video in section.videos.all %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                {{ video.order }}. {{ video.title }}
              </div>
              <div class="d-flex gap-2 align-items-center">
                <!-- ‚Üë‚Üì Ta≈üƒ± -->
                <a href="{% url 'move_video_up' video.id %}" class="btn btn-sm btn-outline-secondary">‚¨ÜÔ∏è</a>
                <a href="{% url 'move_video_down' video.id %}" class="btn btn-sm btn-outline-secondary">‚¨áÔ∏è</a>

                <!-- ‚úèÔ∏è D√ºzenle -->
                <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ video.id }}">
                  ‚úèÔ∏è
                </button>

                <!-- üîÅ Section Deƒüi≈ütir -->
                <form method="post" action="{% url 'move_video_section' video.id %}">
                  {% csrf_token %}
                  <select name="new_section" class="form-select form-select-sm" onchange="this.form.submit()">
                    {% for sec in course.sections.all %}
                      <option value="{{ sec.id }}" {% if sec.id == section.id %}selected{% endif %}>
                        {{ sec.title }}
                      </option>
                    {% endfor %}
                  </select>
                </form>

                <!-- üóëÔ∏è Sil -->
                <form method="post" action="{% url 'delete_video' video.id %}" onsubmit="return confirm('Delete this video?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger">üóëÔ∏è</button>
                </form>
              </div>
            </li>

            <!-- ‚úèÔ∏è Video D√ºzenleme Modalƒ± -->
            <div class="modal fade" id="editModal{{ video.id }}" tabindex="-1">
              <div class="modal-dialog">
                <form method="post" action="{% url 'edit_video' video.id %}">
                  {% csrf_token %}
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Edit Video Title</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <input type="text" name="title" class="form-control" value="{{ video.title }}" required>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                      <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          {% empty %}
            <li class="list-group-item text-muted">No videos yet</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
